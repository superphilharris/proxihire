<<<<<<< HEAD
	<ul class="breadcrumb">
		<li class="dropdown">
		<a class="dropdown-toggle" role="button" data-toggle="dropdown" href="#">
<?php 
	echo $this->category->getName();
=======
<div style="height:50px;" class="categoryAndFilterPadder">&nbsp;</div>

<div class="categoryAndFilterBarWrapper">
<div class="categoryAndFilterBar" onclick="showFilters();">
	<ul class="breadcrumb" style="float:left;padding:0px;">

<?php
$ancestory = getAncestory($this->category, $this->categoryAliases);

$i = count($ancestory) - 1;
while ($i>=0AND property_exists($ancestory[$i], 'children')) {
>>>>>>> master
?>
		<li class="dropdown<?php if($i===0) echo " open"?>">
		<a class="dropdown-toggle" role="button" data-toggle="dropdown" href="#">
			<?php 
				if ($i !== 0) echo $ancestory[$i-1]->aliases[0]; 
			?>
			<b class="caret"></b></a>
			<ul id="branches-dropdown" class="dropdown-menu">
<?php
	foreach ( $ancestory[$i]->children as $sibling ){
?>
				<li><a tabindex="-1" href="#" onclick="goCategory('<?php echo $sibling->aliases[0] ?>');"><?php echo $sibling->aliases[0] ?></a></li>
<?php
	}
?>
			</ul>
		</li>
<?php 
	$i--;
}
?>
	</ul>&nbsp;
	<div class="filterBar">
		<div class="filterBarColumnNames"></div>
		<span class="glyphicon glyphicon-filter filterIcon"></span>
	</div>
	<div class="glyphicon glyphicon-minus filterMinimize" onclick="hideFilters()"></div>
</div>
</div>

<?php 

function getAncestory($categoryName, $alias){
	$ancestory = getAncestoryRecursive($categoryName, $alias);
	if ($ancestory === null) 	return array($alias);
	else 						return $ancestory;
}

function getAncestoryRecursive($categoryName, $alias){
	if(property_exists($alias, 'children')) {
		foreach($alias->children as $child){
			if(in_array($categoryName, $child->aliases)){
				return array($child, $alias);
			}
			$descendants = getAncestoryRecursive($categoryName, $child);
			if($descendants !== null){
				array_push($descendants, $alias);
				return $descendants;
			}
		}
	}
	return null;
}

?>
